(function(){var t,e,r,o=function(t,e){function r(){this.constructor=t}for(var o in e)s.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty,i=function(t,e){return function(){return t.apply(e,arguments)}};t=require("../web/mylib/CommonJs.js"),r=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return o(e,t),e.prototype.base_path="contents/web/",e.prototype.http=require("http"),e.prototype.mime=require("mime"),e.prototype.sio=require("socket.io"),e.prototype.fs=require("fs"),e.prototype.start=function(t){return null==t&&(t=!1),this.app=this.http.createServer(function(t){return function(e,r){return t.http_server_action(e,r)}}(this)),this.ws_start()},e.prototype.http_server_action=function(t,e){var r,o,s,i,n,p,c,h;return h=t.url.replace(/\/{2,}/,"/"),n=this.get_params(h),h=h.replace(/\?.*$/,""),"/"===h[h.length-1]&&(h+="index.html"),p=""+this.base_path+h,s=this.fs.existsSync(p),s?(r=this.fs.readFileSync(p),c=this.mime.lookup(p),e.writeHead(200,{"Content-Type":c}),e.end(r)):(e.writeHead(404),e.end("404 - file not found")),"html"===h.slice(h.length-4,+(h.length-1)+1||9e9)?(i=t.connection.remoteAddress.replace(/.*[^\d](\d+\.\d+\.\d+\.\d+$)/,"$1"),o=(new Date).toLocaleTimeString(),console.log(o+" "+i+" "+h)):void 0},e.prototype.ws_start=function(){return this.websocket=this.ws_port===this.http_port?this.sio(this.app):this.sio(this.ws_port),this.app.listen(this.http_port),this.websocket.on("connection",function(t){return function(e){return e.on("g",function(r){return t.ws_reload(e,r)})}}(this))},e.prototype.ws_reload=function(t,e){var r,o,s,i,n;for(n=[],s=0,i=e.length;i>s;s++)r=e[s],o=""+this.base_path+r,this.fs.existsSync(o)?n.push(this.fs.watch(o,function(){return function(){return t.emit("reload")}}(this))):n.push(void 0);return n},e}(t),e=function(){function t(t){this.parent=t,this.check_dir_tree=i(this.check_dir_tree,this),this.sass=i(this.sass,this),this.coffee=i(this.coffee,this),this.check_dir_tree("./")}return t.prototype.fs=require("fs"),t.prototype.exts={coffee:/\.coffee$/,sass:/\.(sass|scss)$/},t.prototype.regexps=[],t.prototype.exec=require("child_process").exec,t.prototype.coffee=function(t,e){var r;return console.log(t,e),r=this.exec("node ./node_modules/coffee-script/bin/coffee -mc ./",function(){return function(t,e){return console.log(e)}}(this))},t.prototype.sass=function(){return console.log("sass")},t.prototype.check_dir_tree=function(t){var e,r,o,s,i,n,p,c;for(r=this.fs.readdirSync(t),c=[],n=0,p=r.length;p>n;n++)if(e=r[n],o=""+t+e,this.fs.lstatSync(o).isDirectory()){if(o.match(this.parent.ignore_regexp))continue;c.push(this.check_dir_tree(""+t+e+"/"))}else c.push(function(){var t,r;t=this.exts,r=[];for(i in t)s=t[i],e.match(s)?(console.log(e,s,i),this.fs.watch(o,this[i])):r.push(void 0);return r}.call(this));return c},t}(),this.NodeApp=function(){function t(){this.check_dir_tree=i(this.check_dir_tree,this),this.downloader=i(this.downloader,this),this.ftp_downloader_fullpath=i(this.ftp_downloader_fullpath,this),this.readline=i(this.readline,this),this.ftp_downloader=i(this.ftp_downloader,this),this.jsdom_check=i(this.jsdom_check,this),this.csv_to_json=i(this.csv_to_json,this),this.server=new r,this.compiler=new e(this)}return t.prototype.http=require("http"),t.prototype.https=require("https"),t.prototype.fs=require("fs"),t.prototype.cson=require("cson"),t.prototype.Client=require("ftp"),t.prototype.jsdom=require("jsdom"),t.prototype.jsdom_jquery_source="./contents/web/lib/jquery-2.1.3.min.js",t.prototype.ignore_regexp=/(\/node_modules\/)|(\/\.git\/)/,t.prototype.csv_to_json=function(t,e,r){return require("csv-to-array")({file:e,columns:t},r)},t.prototype.jsdom_check=function(t,e){return this.jquery||(this.jquery=this.fs.readFileSync(this.jsdom_jquery_source,{encoding:"utf-8"})),this.jsdom.env({file:t,src:[this.jquery],done:e})},t.prototype.ftp_downloader=function(t,e,r,o,s){var i;return i=new this.Client,i.on("ready",function(t){return function(){return i.get(""+r,function(e,r){if(e)throw e;return r.once("close",function(){return i.end()}),r.pipe(t.fs.createWriteStream(s))})}}(this)),i.connect({host:o,user:t,password:e})},t.prototype.readline=function(t,e){var r,o,s;return r=require("readline"),s=this.fs.ReadStream(t),o=r.createInterface({input:s,output:{}}),o.on("line",e),o.resume()},t.prototype.ftp_downloader_fullpath=function(t,e){var r,o,s,i;return s=t.replace(/.*\/\/([^:]+).*/,"$1"),i=t.replace(/.*\/\/[^:]+:([^@]+).*/,"$1"),r=t.replace(/.*\/([^/]+$)/,"$1"),o=t.replace(/.*@([^/]+).*/,"$1"),this.ftp_downloader(s,i,r,o,e)},t.prototype.downloader=function(t,e){var r,o,s;return r=this.fs.createWriteStream(e),o=t.match(/^https/)?this.https:this.http,s=o.get(t,function(){return function(t){return t.pipe(r)}}(this))},t.prototype.check_dir_tree=function(t,e,r){var o,s,i,n,p,c;for(s=this.fs.readdirSync(t),c=[],n=0,p=s.length;p>n;n++)if(o=s[n],i=""+t+o,!i.match(this.ignore_regexp))if(this.fs.lstatSync(i).isDirectory())c.push(this.check_dir_tree(""+t+o+"/",e,r));else{if(!o.match(e))continue;c.push(r(i,o))}return c},t}(),module.exports=this.NodeApp}).call(this);